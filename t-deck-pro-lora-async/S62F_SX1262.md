# Basic data

Based on the datasheet, here is an explanation of the communication protocol for the S62F LoRa module, covering initialization, configuration, interrupts, data transmission, and recommendations.

### **\#\# Communication Protocol Overview**

The S62F module is controlled by a host microcontroller via a

**Serial Peripheral Interface (SPI)**. The module acts as an SPI slave device.

* **SPI Pins**: The interface uses standard SPI signals: **NSS** (Slave Select), **SCK** (Clock), **MOSI** (Master Out Slave In), and **MISO** (Master In Slave Out).  
* **Control Pins**:  
  * **NRST**: An active-low input to reset the module.  
  * **BUSY**: An output pin that indicates when the module is busy and cannot accept new commands.  
  * **DIO1/DIO2**: General-purpose I/O pins that can be configured to signal various events (interrupts) to the host.

---

### **\#\# Initialization and Configuration**

Proper initialization ensures the module is in a known state and configured for the desired LoRa communication parameters.

1. **Hardware Reset**: Upon power-up, it is recommended to reset the module by pulling the **NRST** pin low.  
2. **Wait for BUSY**: After reset, the host must wait for the **BUSY** pin to go low before sending the first command. The BUSY pin will be high while the module is booting up.  
3. **Set Standby Mode**: Place the device in **Standby mode with the TCXO on (Standby XOSC)**. This is the primary mode for configuration. This mode consumes about  
    **1.96 mA**.  
4. **Configure RF and Packet Parameters**: Send commands over SPI to configure the module. While the datasheet does not specify the exact command opcodes, it notes that the internal  
    **SX1262** transceiver is the core component. Configuration would include setting:  
   * **Frequency**: Within the **865 MHz to 928 MHz** range.  
   * **RF Output Power**: From a minimum level up to a maximum of **\+22 dBm**. This is programmable in 31 steps. Note that achieving \+22 dBm requires a supply voltage of  
      **3.3V**.  
   * **LoRa Parameters**: Spreading Factor (**SF5-SF12**) and Bandwidth (**7.8-500 kHz**).  
   * **PA Ramping Time**: The power amplifier ramping time is programmable from **10 µs to 3400 µs**.

---

### **\#\# Interrupts**

Interrupts are the primary mechanism for the module to signal events to the host processor without requiring the host to continuously poll for status.

* **Interrupt Pins**: The **DIO1** and **DIO2** pins can be configured as multi-purpose digital I/Os to signal events like **TxDone**, **RxDone**, **Timeout**, etc.  
* **RF Switch Control**: **DIO2** has a special function where it can be configured to control an external RF switch. In this mode, it is logical high during transmit (Tx) and logical low otherwise.  
* **Handling**: The host should configure its corresponding input pin as an interrupt-capable pin to detect signal changes from DIO1/DIO2. When an interrupt is triggered, the host should read the module's interrupt status register via SPI to determine the cause and take appropriate action.

---

### **\#\# Regular Communication Procedures**

**Sending Data (Transmit)**

1. **Check BUSY Pin**: Before initiating a command, ensure the **BUSY** pin is low.  
2. **Prepare Data**: Load the data payload into the module's buffer using SPI commands.  
3. **Enter Transmit Mode**: Send the command to start transmission. The **BUSY** pin will go high.  
4. **Wait for Interrupt**: The module will go into Transmit mode, consuming between **80 mA** (for \+14 dBm) and **117 mA** (for \+22 dBm). After transmission is complete, the module will generate an interrupt (e.g., on DIO1) to signal  
    **TxDone**.  
5. **Clear Interrupt**: The host reads the status to confirm the event and then sends a command to clear the interrupt flag.

**Receiving Data (Receive)**

1. **Check BUSY Pin**: Ensure the **BUSY** pin is low.  
2. **Enter Receive Mode**: Send the command to put the module into continuous or single-packet receive mode. In this state, the module consumes approximately  
    **5.6 mA**.  
3. **Wait for Interrupt**: When a valid LoRa packet is received, the module will trigger an interrupt (e.g., on DIO1) to signal **RxDone**.  
4. **Read Data**: The host reads the received data from the module's buffer via SPI. Information like RSSI and SNR can also be retrieved.  
5. **Clear Interrupt**: The host clears the interrupt flag and can then choose to go back into receive mode or another state like sleep.

**Sleep Mode**

* For lowest power consumption, the module can be put into  
   **Sleep mode**, where it consumes only **0.57 µA** (typical). An external event or command from the host is required to wake it up.

---

### **\#\# Recommendations**

* **Handling and Storage**: The module is rated at Moisture Sensitivity Level 3 (MSL3). After opening the sealed bag, it must be mounted within  
   **168 hours** under factory conditions (\<30°C / 60% RH). If these conditions are not met, baking the module for  
   **12 hours at 125°C** is required before mounting.  
* **Power Supply**: To achieve the maximum output power of **\+22 dBm**, a stable **3.3V** supply voltage is required. The supply voltage can be lowered for reduced power output (e.g., 2.7V for \+20 dBm).  
* **Operating Temperature**: The standard operating temperature range is **\-40°C to \+85°C**. 

# Communication protocol

The communication protocol is **SPI**, with the host acting as the master. The interface corresponds to

**CPOL=0** and **CPHA=0**. A transaction is initiated when the host pulls

**NSS** low and terminated when it pulls it high.

A critical pin is

**BUSY**, which the module holds high when it's performing an internal operation (like changing modes or processing an interrupt). The host

**must wait for the BUSY pin to be low** before sending a new command to the module.

---

### **\#\# Initialization and Configuration**

This sequence details the commands required to set up the module after a power-on or reset event. The command order for configuration is critical to avoid unexpected behavior.

1. **Hardware Reset**: Pull the **NRST** pin low for at least 100 µs to reset the chip. After reset, the chip automatically enters  
    **STDBY\_RC** mode, and the **BUSY** pin will go low to indicate it's ready for commands.  
2. **Set Regulator Mode**: To optimize for low power consumption, enable the DC-DC converter. This must be done in STDBY\_RC mode.  
   * Command: **`SetRegulatorMode(0x96)`**  
   * Parameter:  
      `0x01` (DC-DC \+ LDO enabled)  
3. **Set Packet Type**: Configure the module for LoRa modulation. This must be the first configuration step.  
   * Command: **`SetPacketType(0x8A)`**  
   * Parameter:  
      `0x01` (LoRa)  
4. **Set RF Frequency**: Define the operating frequency.  
   * Command: **`SetRfFrequency(0x86)`**  
   * Parameter: A 32-bit value calculated as  
      `RF_Freq = Freq_Hz * 2^25 / F_XTAL` (where F\_XTAL is 32 MHz).  
5. **Configure Power Amplifier (PA)**: Configure the PA for the SX1262 and set the optimal settings for the desired output power. For \+22 dBm:  
   * Command: **`SetPaConfig(0x95)`**  
   * Parameters:  
      `paDutyCycle=0x04`, `hpMax=0x07`, `deviceSel=0x00` (SX1262), `paLut=0x01`.  
6. **Configure TX Power and Ramp Time**: Set the target output power and PA ramping time.  
   * Command: **`SetTxParams(0x8E)`**  
   * Parameters:  
      `power` (e.g., `0x16` for \+22 dBm), `rampTime` (e.g., `0x04` for 200 µs).  
7. **Define Modulation Parameters**: Set the LoRa-specific parameters like Spreading Factor (SF) and Bandwidth (BW).  
   * Command: **`SetModulationParams(0x8B)`**  
   * Parameters: 8 bytes defining SF, BW, Coding Rate (CR), and Low Data Rate Optimization (LDRO).  
8. **Define Packet Parameters**: Configure the LoRa packet structure.  
   * Command: **`SetPacketParams(0x8C)`**  
   * Parameters: 9 bytes defining preamble length, header type, payload length, CRC, and IQ inversion.

---

### **\#\# Interrupt Handling**

Interrupts are used to signal events like `TxDone` and `RxDone`.

1. **Configuration**: Use the **`SetDioIrqParams(0x08)`** command to enable interrupts and map them to a physical DIO pin (DIO1, DIO2, or DIO3).  
   * **IrqMask**: A 16-bit mask to enable the desired interrupts (e.g., `TxDone`, `RxDone`, `Timeout`).  
   * **DIOxMask**: A 16-bit mask to route the enabled interrupts to the chosen DIO pin.  
2. **Handling an Interrupt**: When an interrupt occurs, the host should:  
   * Read the interrupt source by sending the  
      **`GetIrqStatus(0x12)`** command.  
   * After handling the event (e.g., reading the received data), clear the interrupt flag by sending the  
      **`ClearIrqStatus(0x02)`** command with a mask indicating which flag(s) to clear.

---

### **\#\# Regular Communication Procedures**

**Sending a Packet**

1. **Check BUSY**: Ensure the **BUSY** pin is low.  
2. **Set Buffer Base Address**: Define the starting address for the TX payload in the 256-byte data buffer using **`SetBufferBaseAddress(0x8F)`**.  
3. **Write Payload**: Write the data to be transmitted into the buffer using the **`WriteBuffer(0x0E)`** command.  
4. **Initiate Transmit**: Send the **`SetTx(0x83)`** command. A timeout can be specified. The module will handle the transmission and return to its configured fallback mode (default STDBY\_RC) when complete, triggering a  
    `TxDone` interrupt.

**Receiving a Packet**

1. **Check BUSY**: Ensure the **BUSY** pin is low.  
2. **Initiate Receive**: Send the **`SetRx(0x82)`** command with a timeout parameter. A timeout of  
    `0xFFFFFF` enables continuous receive mode. The  
    **BUSY** pin will go low once the receiver is active.  
3. **Wait for Interrupt**: An `RxDone` interrupt will trigger upon successful packet reception.  
4. **Get Packet Info**: If an `RxDone` interrupt occurs:  
   * Send  
      **`GetRxBufferStatus(0x13)`** to get the received payload length and its starting address in the buffer.  
   * Send  
      **`GetPacketStatus(0x14)`** to retrieve the **RSSI and SNR** of the last received packet.  
5. **Read Payload**: Use the **`ReadBuffer(0x1E)`** command with the address from the previous step to read the data from the buffer.

---

### **\#\# Recommendations**

* **Fallback Mode**: After a TX or RX operation, the chip defaults to STDBY\_RC mode. To reduce the time required for the next operation, use the  
   **`SetRxTxFallbackMode(0x93)`** command to set the fallback mode to **STDBY\_XOSC (0x30)**, which keeps the crystal oscillator running.  
* **PA Configuration**: The **`SetPaConfig`** command must be used to select the correct device (SX1262) to enable the high-power \+22 dBm path. Using the optimal settings for lower power levels can significantly improve efficiency.  
* **BUSY Line**: Always check that the **BUSY** pin is low before sending any SPI command to ensure the transceiver is ready to accept it.

